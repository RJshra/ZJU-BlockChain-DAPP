# 去中心化学生社团组织治理应用

## 如何运行

1. ##### 在 `./contracts` 中编译合约，运行如下的命令部署到ganache上：

>```bash
>npm install
>npx hardhat run scripts/deploy.ts --network ganache
>```

2.拷贝后端abis和合约地址到./frontend/src/utils

3.在 `./frontend` 中启动前端程序，运行如下的命令：

>```bash
>npm install
>npm run start
>```

## 功能实现分析

简单描述：项目完成了要求的哪些功能？每个功能具体是如何实现的？

1.实现了学生初始领取一定积分（10000），且仅能领取一次。方法是调用ERC20合约的铸币功能，并且使用mapping确保每个账户只能领取一次。

2.实现学生可以使用一定数量通证积分（500），发起关于该社团进行活动或制定规则的提案（Proposal）。学生发起的提案会被保存到区块上，提案储存了提案ID、发起人地址、开始时间、持续时间、提案名称、是否结束、同意人数、反对人数、以及累计投票额度。每个提案还保存了一个mapping用来记录某个地址是否投过票。该提案以结构体的形式储存在链上。

3.提案发起后一定支出时间内，使用一定数量通证积分（100）可以对提案进行投票（赞成或反对，限制投票次数），投票行为被记录到区块链上。投票行为记录即保存该地址在该提案上，使用mapping保存。每人仅能投票一次。并且投票时会更新该提案时间，确保不能对截止的提案投票。

4.提案投票时间截止后，赞成数大于反对数的提案通过，提案发起者作为贡献者可以领取一定的积分奖励。每次进行查询、发起投票、投票等操作时都会更新时间，检查提案是否截止。一旦提案截至会自行判断是否通过，若通过该合约还会将所有人投票所花费的积分转给提案发起者，但不会将发起提案的花费返还，以激励发起人发起高质量提案。

5.每个学生可以查看自己发起的所有提案。

bonus：发起提案并通过3次的学生，可以领取社团颁发的纪念品（ERC721）。即合约会自动检查学生是否满足领取纪念品的条件，一旦满足将给予其领取ERC721的资格，会让学生在领取时输入纪念品名称，不唯一，并自行分配一个唯一的标识符，作为纪念品给学生。



## 项目运行截图

项目运行成功的关键页面和流程截图。主要包括操作流程以及和区块链交互的截图。

### 1.连接钱包：


输入密码：

![image-20221106155628642](.\README.assets\image-20221106155628642.png)

![image-20221106155725555](.\README.assets\image-20221106155725555.png)

成功登录：

![image-20221106160214684](.\README.assets\image-20221106160214684.png)

### 2.领取积分：

点击领取积分：

![image-20221106160334825](.\README.assets\image-20221106160334825.png)

与区块链交互：

![image-20221106160416824](.\README.assets\image-20221106160416824.png)

成功领取积分：

![image-20221106160459217](.\README.assets\image-20221106160459217.png)

### 3.发起提案：

点击“发起提案后”可以看到发起提案的注意事项：

![image-20221106160558423](.\README.assets\image-20221106160558423.png)

点击“Open Modal”（后续改成了”发起议案“）发起提案：

可以选择提案的内容、提案的截止日期：

![image-20221106160645966](.\README.assets\image-20221106160645966.png)

若是选择不合法的日期（截止日期在当前时间之前会报错）：

![image-20221106160841345](.\README.assets\image-20221106160841345.png)

发起提案时与区块链交互：（这里连续发布多次提案，为后面演示bonus做准备）

![image-20221106160922610](.\README.assets\image-20221106160922610.png)

发表提案成功时会显示消息：

![image-20221106163332442](.\README.assets\image-20221106163332442.png)

### 4.投票+查看演示

点击“所有提案”可以看到所有提案信息，需要先点击“点击更新”在区块链上判断未完成提案是否截止，再查询所有提案信息。

![image-20221106161200075](.\README.assets\image-20221106161200075.png)

交互：

![image-20221106161229537](.\README.assets\image-20221106161229537.png)

投票：在提案信息栏里可以点击“同意”或反对进行投票。

![image-20221106161320955](.\README.assets\image-20221106161320955.png)

交互：

![image-20221106161447975](.\README.assets\image-20221106161447975.png)

值得注意的是，投票完信息不会自动刷新，需要手动点击按钮刷新。

除此之外，若是对已经截止但还未在表格里更新信息的提案进行投票，是不被允许的，如下： message里显示了 the vote is over的信息，不能投票了。 

![image-20221106161706714](.\README.assets\image-20221106161706714.png)

点击刷新后查看更新的表格：若是已经截止的提案，操作栏将取消，无法进行相关操作。

![image-20221106161805477](.\README.assets\image-20221106161805477.png)

筛选功能演示：筛选已通过的提案：

![image-20221106161920687](.\README.assets\image-20221106161920687.png)

单独筛选未截止的提案，方便快速投票：

![image-20221106162025734](C:\Users\RJ\Desktop\1\README.assets\image-20221106162025734.png)

### 5.个人提案查看

在”当前用户-我的议案“中可以快速查看当前账户发起的议案，过程与方法和上述查询所有议案一致。在”我的议案“里面，发起议案的地址会被省略。

![image-20221106161920687](.\README.assets\image-20221106161920687.png)

### 6.领取bonus

先在“当前用户-个人账户信息”查看，发起三次提案并通过可以领取奖品。

![image-20221106162121442](.\README.assets\image-20221106162121442.png)

然后点击领取按钮即可领取，并输入自定义奖品名称。

![image-20221106162418956](.\README.assets\image-20221106162418956.png)

然后在表格中就可以看见刚刚领取的奖品与系统分配的ID。

![image-20221106162447962](.\README.assets\image-20221106162447962.png)



### 7.提案不通过情况

最终发表提案情况：

![image-20221106162630171](.\README.assets\image-20221106162630171.png)

最后一个是自己给自己投反对票，因此不通过的话投票花费不会返还，加上一共发表6个提案，总共消耗积分6*500+100=3100，当前用户还会剩下6900积分。若是提案成功通过，就会返回所有人投票的积分，这里只有我一人投票，因此相当于投票无消耗。

![image-20221106162934961](.\README.assets\image-20221106162934961.png)
